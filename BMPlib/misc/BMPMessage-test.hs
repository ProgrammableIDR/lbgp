{-# LANGUAGE OverloadedStrings #-}
module Main where
import qualified Data.ByteString as BS
import qualified Data.ByteString.Lazy as L
import qualified Data.ByteString.Base16
import Data.Attoparsec.ByteString -- from package attoparsec
import Data.Binary

import BMPMessage
import BGPlib hiding (BGPByteString,TLV,getBGPByteString)

fromBGP :: BS.ByteString -> BGPMessage
fromBGP = decode . L.fromStrict

fromHex = fst . Data.ByteString.Base16.decode


parse' p bs = feed (parse p bs) BS.empty

--main = print $ parse' bmpMessageParser' s1

main = print $ fromBGP
               -- parse' bmpMessageParser
                      _sentOpen
                      -- _rcvdOpen
                      -- _update1
                      -- _BMPInitiation
                      -- _BMPPeerUP
                      -- _BMPPeerStats
                      -- _BMPRouteMonitoring1
                      -- _BMPRouteMonitoring2
                      --  getBGPMessage
                      -- $ fromHex "ffffffffffffffffffffffffffffffff003f0104fbf7005ac0a8fe032202060104000100010202800002020200020440024078020641040000fbf702024700"
                      -- $ fromHex "ffffffffffffffffffffffffffffffff003b0104fbf500b4c0a8fe011e02060104000100010202800002020200020641040000fbf5020440020078"
                      -- fromHex "ffffffffffffffffffffffffffffffff003b0104fbf500b4c0a8fe011e02060104000100010202800002020200020641040000fbf5020440020078"
                      -- fromHex "ffffffffffffffffffffffffffffffff003f0104fbf7005ac0a8fe032202060104000100010202800002020200020440024078020641040000fbf702024700"


_sentOpen = fromHex "0104fbf7005ac0a8fe032202060104000100010202800002020200020440024078020641040000fbf702024700"
_rcvdOpen = fromHex "0104fbf500b4c0a8fe011e02060104000100010202800002020200020641040000fbf5020440020078"
_update1 = fromHex "020000003b4001010040021602050000fbf50000637400000cb900000b62000009d74003040a000202c008140cb91f730cb975e80cb9c3510cb9d4800cb9d48118010010159dfa801085af1667f9b81667f5e41667f3d01667f3781767f1401667c5d016671bf416671b9c16671aa4162bfb30162be7dc"

_BMPInitiation = fromHex "04000100964a756e69706572204e6574776f726b732c20496e632e206d33323020696e7465726e657420726f757465722c206b65726e656c204a554e4f532031352e3152342e362c204275696c6420646174653a20323031362d30362d32332032323a30353a30362055544320436f707972696768742028632920313939362d32303136204a756e69706572204e6574776f726b732c20496e632e000200086d3332302d726530"

_BMPPeerUP = fromHex "03000000000000000000000000000000000000000000000a0002020000fbf5c0a8fe015bacb5ab000000000000000000000000000000000a00020100b39e52ffffffffffffffffffffffffffffffff003f0104fbf7005ac0a8fe032202060104000100010202800002020200020440024078020641040000fbf702024700ffffffffffffffffffffffffffffffff003b0104fbf500b4c0a8fe011e02060104000100010202800002020200020641040000fbf5020440020078"
_BMPPeerStats = fromHex "01000000000000000000000000000000000000000000000a0002020000fbf5c0a8fe015bacb5ab00000000000000090000000400000000000100040000f747000200040000000000030004000000000004000400000000000500040000000000060004000000000007000800000000000acbf80008000800000000000acbf6"
_BMPRouteMonitoring1 = fromHex "00000000000000000000000000000000000000000000000a0002020000fbf5c0a8fe015ba26dc000000000ffffffffffffffffffffffffffffffff004902000000184001010240020a02020000fbf50000fbf84003040a0002020020c0a8630518ac120418ac120318ac1100180a1e42180a1e40"

_BMPRouteMonitoring2 = fromHex "00000000000000000000000000000000000000000000000a0002020000fbf5c0a8fe015ba26dc000000000ffffffffffffffffffffffffffffffff0111020000003e4001010040020e02030000fbf500006374000034174003040a000202c0070800003417a29e2001c008143417274f34174a4c34174e5234175014341750321801000018c629df18c629de18adf53b18adf53a18a2fb5218a29f8418a29f2e17a29f2a17a29f2818a29f2417a29f2217a29f2018a29f1f18a29f1e18a29f1d18a29f1c18a29f1b18a29f1a18a29f1918a29f1818a29f1718a29f1618a29f1518a29f1418a29f1318a29f1218a29f1118a29f1018a29f0f18a29f0e18a29f0d18a29f0c18a29f0b18a29f0a18a29f0918a29f0818a29f0718a29f0618a29f0518a29f0418a29f0318a29f0218a29f0118a29f00184044c018010101"
